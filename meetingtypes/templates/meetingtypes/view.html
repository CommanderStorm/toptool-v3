{% extends "toptool_common/base.html" %}
{% load i18n %}

{% block title %}{{ meetingtype }} - {% trans "Sitzungsübersicht" %}{% endblock %}

{% block content %}
    <h1>{{ meetingtype.name }}: {% trans "Alle Sitzungen" %}</h1>
    
    {% if meetingtype.admin_permission in perms %}
        <table class="table">
            <tr>
                <td><a href="{% url "editmt" meetingtype.id %}" class="btn btn-default">{% trans "Sitzungsgruppe bearbeiten" %}</a></td>
                <td><a href="{% url "addmeeting" meetingtype.id %}" class="btn btn-default">{% trans "Sitzung anlegen" %}</a></td>
                <td><a href="{% url "addmeetingseries" meetingtype.id %}" class="btn btn-default">{% trans "Sitzungsserie anlegen" %}</a></td>
            </tr>
        <table>
    {% endif %}

    <h2>{% trans "Kommende Sitzungen" %}</h2>
    <table class="table">
    <tr>
        <th>{% trans "Sitzung" %}</th>
        <th>{% trans "Datum" %}</th>
        <th>{% trans "Zeit" %}</th>
        <th>{% trans "Raum" %}</th>
        <th>{% trans "TOPs" %}</th>
        <th>{% trans "Bearbeiten" %}</th>
    </tr>
    {% for meeting in upcoming_meetings %}
        <tr>
            <td><a href="{% url "viewmeeting" meetingtype.id meeting.id %}">
                    {{ meeting.get_title }}</a></td>
            <td>{{ meeting.time | date:"D" }} {{ meeting.time | date:"SHORT_DATE_FORMAT" }}</td>
            <td>{{ meeting.time | date:"TIME_FORMAT" }}</td>
            <td>{{ meeting.room }}</td>
            <td>
                {% if not meeting.topdeadline_over or meeting.meetingtype.admin_permission in perms or user == meeting.sitzungsleitung %}
                    {% if not meeting.imported %}
                        <a href="{% url "addtop" meetingtype.id meeting.id %}" class="btn btn-default btn-sm">{% trans "TOP eintragen" %}</a>
                    {% endif %}
                {% endif %}
            </td>
            <td>
                {% if meetingtype.admin_permission in perms or user == meeting.sitzungsleitung %}
                    <a href="{% url "editmeeting" meetingtype.id meeting.id %}" class="btn btn-default btn-sm">
                        {% trans "bearbeiten" %}</a>
                {% endif %}
                {% if meetingtype.admin_permission in perms %}
                    <a href="{% url "delmeeting" meetingtype.id meeting.id %}" class="btn btn-default btn-sm">
                        {% trans "löschen" %}</a>
                {% endif %}
            </td>
        </tr>
    {% endfor %}
    </table>
    
    <h2>{% trans "Vergangene Sitzungen" %}</h2>
    <table class="table">
    <tr>
        <th>{% trans "Sitzung" %}</th>
        <th>{% trans "Datum" %}</th>
        <th>{% trans "Zeit" %}</th>
        <th>{% trans "Raum" %}</th>
        <th>{% trans "Protokoll" %}</th>
        <th>{% trans "Bearbeiten" %}</th>
    </tr>
    {% for meeting in past_meetings %}
        <tr>
            <td><a href="{% url "viewmeeting" meetingtype.id meeting.id %}">{{ meeting.get_title }}</a></td>
            <td>{{ meeting.time | date:"D" }} {{ meeting.time | date:"SHORT_DATE_FORMAT" }}</td>
            <td>{{ meeting.time | date:"TIME_FORMAT" }}</td>
            <td>{{ meeting.room }}</td>
            <td>
                {% if meeting.protokoll %}
                    {% if meetingtype.permission in perms or meeting.protokoll.approved %}
                        <a href="{% url "protokoll" meetingtype.id meeting.id "html" %}" class="btn btn-default btn-sm">HTML</a>
                        <a href="{% url "protokoll" meetingtype.id meeting.id "pdf" %}" class="btn btn-default btn-sm">PDF</a>
                        <a href="{% url "protokoll" meetingtype.id meeting.id "txt" %}" class="btn btn-default btn-sm">TXT</a>
                    {% endif %}
                {% elif not meeting.imported %}
                    {% if not meeting.protokollant %}
                        {% if meetingtype.permission in perms %}
                            <a href="{% url "editprotokoll" meetingtype.id meeting.id %}" class="btn btn-default btn-sm">{% trans "hinzufügen" %}</a>
                        {% endif %}
                    {% elif meetingtype.admin_permission in perms or user == meeting.sitzungsleitung or user == meeting.protokollant %}
                        <a href="{% url "editprotokoll" meetingtype.id meeting.id %}" class="btn btn-default btn-sm">{% trans "hinzufügen" %}</a>
                    {% endif %}
                {% endif %}
            </td>
            <td>
                {% if meetingtype.admin_permission in perms or user == meeting.sitzungsleitung %}
                    <a href="{% url "editmeeting" meetingtype.id meeting.id %}" class="btn btn-default btn-sm">
                        {% trans "bearbeiten" %}</a>
                {% endif %}
                {% if meetingtype.admin_permission in perms %}
                    <a href="{% url "delmeeting" meetingtype.id meeting.id %}" class="btn btn-default btn-sm">
                        {% trans "löschen" %}</a>
                {% endif %}
            </td>
        </tr>
    {% endfor %}
    </table>

    {% if years %}
        <h2>{% trans "Archiv" %}</h2>
        <table class="table">
            <tr>
                {% for year in years %}
                    <td><a href="{% url "viewarchive" meetingtype.id year %}" class="btn btn-default">{{ year }}</a></td>
                    {% if not forloop.last and forloop.counter|divisibleby:8 %}
                        </tr><tr>
                    {% endif %}
                {% endfor %}
            </tr>
        </table>
    {% endif %}

    {% if user.is_authenticated %}
        <p><a href="{% url "ownmts" %}" class="btn btn-default">{% trans "Zurück zur Gruppen-Übersicht" %}</a></p>
    {% endif %}
{% endblock %}
