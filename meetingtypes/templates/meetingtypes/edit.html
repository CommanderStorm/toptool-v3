{% extends "base.html" %}
{% load i18n %}
{% load bootstrap3 %}

{% block title %}{% if add %}{% trans "Sitzungsgruppe erstellen" %}{% else %}{% trans "Sitzungsgruppe bearbeiten" %}{% endif %}{% endblock %}

{% block content %}
    {# JS for dual list box #}
    <script type="text/javascript">
        $(function () {
            // activate DualListbox
            $('.duallistbox').bootstrapDualListbox({
                moveOnSelect: false,
                nonSelectedListLabel: "{% trans "Nicht ausgewählt" %}",
                selectedListLabel: "{% trans "Ausgewählt" %}",
                filterTextClear: "{% trans "Alle anzeigen" %}",
                filterPlaceHolder: "{% trans "Filter" %}",
                moveSelectedLabel: "{% trans "Ausgewählte verschieben" %}",
                moveAllLabel: "{% trans "Alle verschieben" %}",
                removeSelectedLabel: "{% trans "Ausgewählte löschen" %}",
                removeAllLabel: "{% trans "Alle löschen" %}",
                infoText: "{% trans "Alle angezeigt {0}" %}",
                infoTextFiltered: '<span class="label label-warning">{% trans "Gefiltert {0} von {1}" %}</span>',
                infoTextEmpty: "{% trans "Liste leer" %}",
            });
        });
    </script>

    <h1>{% if add %}{% trans "Sitzungsgruppe erstellen" %}{% else %}{% trans "Sitzungsgruppe bearbeiten" %}{% endif %}</h1>
    {% if not add %}
    {% if meetingtype.tops and meetingtype.standard_tops or meetingtype.attendance %}
        <div class="panel panel-custom">
            <div class="panel-body panel-center">
                {% if meetingtype.tops and meetingtype.standard_tops %}
                    <a href="{% url "liststdtops" meetingtype.id %}" class="asbtn-left">{% bootstrap_icon "tasks" %} {% trans "Standard-TOPs bearbeiten" %}</a>
                {% endif %}
                {% if meetingtype.attendance %}
                    <a href="{% url "delpersons" meetingtype.id %}" class="asbtn">{% bootstrap_icon "user" %} {% trans "Personen löschen" %}</a>
                    {% if meetingtype.attendance_with_func %}
                        <a href="{% url "functions" meetingtype.id %}" class="asbtn-right">{% bootstrap_icon "education" %} {% trans "Ämter bearbeiten" %}</a>
                    {% endif %}
                {% endif %}
            </div>
        </div>
    {% endif %}
    {% endif %}

    <form method="post" action="">
        {% csrf_token %}
    
        {% bootstrap_form_errors form %}
        <fieldset>
            <legend>{% trans "Allgemein" %}</legend>
            {% bootstrap_field form.name %}
            {% if add %}
                {% bootstrap_field form.id %}
            {% else %}
                <div class="form-group">
                    <label class="control-label" for="id_id">{% trans "URL-Kurzname" %}</label>
                    <p class="form-control-static">{{ meetingtype.id }}</p>
                </div>
            {% endif %}
            {% bootstrap_field form.mailinglist %}
            {% bootstrap_field form.public %}
            {% bootstrap_field form.ical %}
        </fieldset>
        <fieldset>
            <legend>{% trans "Anwesenheitsliste" %}</legend>
            {% bootstrap_field form.attendance %}
            <div id="attendance_fields">
                {% bootstrap_field form.attendance_with_func %}
            </div>
        </fieldset>
        <fieldset>
            <legend>{% trans "Protokoll" %}</legend>
            {% bootstrap_field form.protokoll %}
            <div id="protokoll_fields">
                {% bootstrap_field form.write_protokoll_button %}
                {% bootstrap_field form.approve %}
                {% bootstrap_field form.motion_tag %}
                {% bootstrap_field form.point_of_order_tag %}
                {% bootstrap_field form.attachment_protokoll %}
            </div>
        </fieldset>
        <fieldset>
            <legend>{% trans "Tagesordnung" %}</legend>
            {% bootstrap_field form.tops %}
            <div id="tops_fields">
                {% bootstrap_field form.top_perms %}
                {% bootstrap_field form.top_deadline %}
                {% bootstrap_field form.standard_tops %}
                {% bootstrap_field form.other_in_tops %}
                {% bootstrap_field form.attachment_tops %}
                {% bootstrap_field form.first_topid %}
            </div>
        </fieldset>
        <fieldset>
            <legend>{% trans "Rechte" %}</legend>
            <p class="help-block">{% trans "Wer Rechte hat, kann die Sitzungen der Sitzungsgruppe sehen, TOPs hinzufügen, die Protokolle lesen und kann Sitzungsleitung und Protokollant werden." %}</p>
            {% bootstrap_field form.groups %}
            {% bootstrap_field form.users %}
        </fieldset>
        <fieldset>
            <legend>{% trans "Admin-Rechte" %}</legend>
            <p class="help-block">{% trans "Wer Admin-Rechte hat, kann diese Einstellungen bearbeiten, Sitzungen erstellen und bearbeiten, TOPs bearbeiten und umsortieren etc." %}</p>
            {% bootstrap_field form.admin_groups %}
            {% bootstrap_field form.admin_users %}
        </fieldset>

        <div>
            <button type="submit" class="btn btn-default asbtn-left">{% if add %}{% trans "Erstellen" %}{% else %}{% trans "Ändern" %}{% endif %}</button>
            <a href="{% if add %}{% url "allmts" %}{% else %}{% url "viewmt" meetingtype.id %}{% endif %}" class="btn btn-default asbtn-right">{% trans "Abbrechen" %}</a>
        </div>
    </form>

    <script>
        window.onload = toggleDisabled;
        document.getElementById("id_attendance").onclick = toggleDisabled;
        document.getElementById("id_protokoll").onclick = toggleDisabled;
        document.getElementById("id_tops").onclick = toggleDisabled;

        function toggleDisabled() {
            if (document.getElementById("id_attendance").checked) {
                $('#attendance_fields').show();
            } else {
                $('#attendance_fields').hide();
            }
            if (document.getElementById("id_protokoll").checked) {
                $('#protokoll_fields').show();
            } else {
                $('#protokoll_fields').hide();
            }
            if (document.getElementById("id_tops").checked) {
                $('#tops_fields').show();
            } else {
                $('#tops_fields').hide();
            }
        }
    </script>
{% endblock %}
