{% load static %}
{% load i18n %}
{% load django_bootstrap5 %}
{% load auth_methods %}

{% get_keycloak_status as keycloak_status %}
<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta
        content="width=device-width, initial-scale=1, shrink-to-fit=no"
        name="viewport"
    >
    {% include "snippets/favoticons.html" %}


    <script src="{% static "toptool/js/jquery.min.js" %}"></script>
    <script src="{% static "toptool/js/jquery-ui.min.js" %}"></script>
    <script src="{% static "toptool/js/jquery.mCustomScrollbar.concat.min.js" %}"></script>
    <script src="{% static "bootstrap/dist/js/bootstrap.min.js" %}"></script>
    <script src="{% static "toptool/js/bootstrap-duallistbox.min.js" %}"></script>

    <link
        href="{% static "toptool/css/jquery-ui.min.css" %}"
        media="all"
        rel="stylesheet"
    >
    <link
        href="{% static "toptool/css/jquery-ui.structure.min.css" %}"
        media="all"
        rel="stylesheet"
    >
    <link
        href="{% static "toptool/css/jquery-ui.theme.min.css" %}"
        media="all"
        rel="stylesheet"
    >
    <link
        href="{% static "toptool/css/jquery.mCustomScrollbar.min.css" %}"
        media="all"
        rel="stylesheet"
    >
    <link
        href="{% static "bootstrap/dist/css/bootstrap.min.css" %}"
        media="all"
        rel="stylesheet"
    >
    <link
        href="{% static "toptool/css/bootstrap-theme.min.css" %}"
        media="all"
        rel="stylesheet"
    >
    <link
        href="{% static "toptool/css/bootstrap-duallistbox.min.css" %}"
        media="all"
        rel="stylesheet"
    >

    <link
        href="{% static "toptool/css/style.css" %}"
        media="all"
        rel="stylesheet"
    >
    {% if user.profile.colormode == "dark" %}
    <link
        href="{% static "toptool/css/colormode/darkmode.css" %}"
        media="all"
        rel="stylesheet"
    >
    {% elif user.profile.colormode != "light"  %}
    <link
        href="{% static "toptool/css/colormode/default-colormode.css" %}"
        media="all"
        rel="stylesheet"
    >
    {% endif %}


    <noscript>
        <link
            href="{% static "toptool/css/noscript.css" %}"
            media="all"
            rel="stylesheet"
        >
    </noscript>

    {% if user.profile.color %}
    <style>
        :root {
            --main-color: {{ user.profile.color }};
        }
    </style>
    {% endif %}

    {% block header %}{% endblock %}

    <title>{% block title %}{% trans "Sitzungstool" %}{% endblock %}</title>
    {{ form.media }}
</head>

<body>
    <nav class="navbar navbar-custom">
        <div class="container">
            {# button to show menu on small devices#}
            <div class="navbar-header">
                <button
                    type="button"
                    class="jsonly navbar-toggle collapsed"
                    data-toggle="collapse"
                    data-target="#my-navbar-collapse"
                >
                    <span class="sr-only">Toggle navigation</span>
                    <span class="bi bi-list"></span>
                </button>
            </div>


            {# menu content #}
            <div
                class="navbar-collapse"
                id="my-navbar-collapse"
            >
                {% if user.is_authenticated %}
                <ul class="nav navbar-nav navbar-left">
                    {% if user.is_staff %}
                    <li><a href="{% url "allmts" %}"><span class="bi bi-gear"></span>&nbsp;{% trans "Admin" %}</a></li>
                    {% endif %}
                    {% if meetingtypes|length != 1 %}
                    <li><a href="{% url "ownmts" %}"><strong><span class="bi bi-house-door-fill"></span>&nbsp;{% trans "Ãœbersicht" %}</strong></a></li>
                    {% endif %}
                    {% for meetingtype in meetingtypes %}
                    <li><a
                            href="{% url "viewmt" meetingtype.id %}"
                            {% if meetingtype == active_meetingtype %}
                            class="active"
                            {% endif %}
                        >{{ meetingtype }}</a></li>
                    {% endfor %}
                </ul>
                {% endif %}

                {# language chooser #}
                <form
                    action="{% url "set_language" %}"
                    method="post"
                    class="navbar-right navbar-form"
                    role="form"
                >
                    <div class="form-group">
                        {% csrf_token %}
                        <input
                            name="next"
                            type="hidden"
                            value=""
                        />

                        <div
                            class="btn-group"
                            role="group"
                            aria-label="Language menu"
                        >
                            {% get_current_language as LANGUAGE_CODE %}
                            {% get_available_languages as LANGUAGES %}
                            {% get_language_info_list for LANGUAGES as languages %}

                            {% for language in languages %}
                            <button
                                type="submit"
                                name="language"
                                value="{{ language.code }}"
                                class="btn btn-link{% if language.code == LANGUAGE_CODE %} selected{% endif %}"
                            >
                                {{ language.name_local }}
                            </button>
                            {% endfor %}
                        </div>
                    </div>
                </form>
                {# end language chooser #}

                {# on the right: login #}
                <ul class="nav navbar-nav navbar-right">
                    {% if user.is_authenticated %}
                    <li>
                        <a href="{% url "editprofile" %}">
                            {% if user.get_full_name %}
                            <span class="bi bi-person-fill"></span>&nbsp;{{ user.get_full_name }}
                            {% else %}
                            <span class="bi bi-person-fill"></span>&nbsp;{{ user.username }}
                            {% endif %}
                        </a>
                    </li>
                    <li>
                        <a href="{% url "logout" %}">{% trans "Logout" %}</a>
                    </li>
                    {% else %}
                    <li>
                        <a href="{% if keycloak_status %}{% url "oidc_authentication_init" %}{% else %}{% url "login" %}?next={{ request.path }}{% endif %}">
                            {% trans "Login" %}
                        </a>
                    </li>
                    {% endif %}
                </ul>
                {# end login #}
            </div>
        </div>
    </nav>

    <div class="wrapper">
        {% block sidebar %}{% endblock %}

        <div class="container">
            {# messages #}
            {% if messages %}
            {% bootstrap_messages messages %}
            {% endif %}

            {# content #}
            {% block content %}{% endblock %}
        </div>
    </div>

    <footer class="navbar navbar-custom navbar-fixed-bottom">
        <div class="container">
            <ul class="nav navbar-nav">
                <li><a href="http://fs.tum.de/datenschutz/">{% trans "Datenschutz" %}</a></li>
                <li><a href="http://fs.tum.de/impressum/">{% trans "Impressum" %}</a></li>
            </ul>
        </div>
    </footer>
</body>

</html>
