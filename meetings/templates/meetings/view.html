{% extends "base.html" %}
{% load i18n %}
{% load email_obfuscator %}
{% load bootstrap3 %}

{% block title %}{{ meeting.meetingtype }} - {% trans "Details zur Sitzung" %}{% endblock %}

{% block content %}
    <h1>
        {% blocktrans trimmed with title=meeting.get_title time=meeting.time|date:"SHORT_DATETIME_FORMAT" %}
            {{ title }} am {{ time }}
        {% endblocktrans %}
    </h1>

    <div class="row toprow">
        <h4>
        <div class="col-xs-1">
            {% if meeting.previous %}
                <a href="{% url "viewmeeting" meeting.meetingtype.id meeting.previous.id %}" class="asbtn-left">{% bootstrap_icon "chevron-left" %}</a>
            {% endif %}
        </div>
        <div class="col-xs-10">
            <a href="{% url "viewmt" meeting.meetingtype.id %}" class="asbtn">{% bootstrap_icon "list" %}&nbsp;{% trans "zurück zur Übersicht" %}</a>
        </div>
        <div class="col-xs-1">
            {% if meeting.next %}
                <a href="{% url "viewmeeting" meeting.meetingtype.id meeting.next.id %}" class="asbtn-right" style="float: right;">{% bootstrap_icon "chevron-right" %}</a>
            {% endif %}
        </div>
        </h4>
    </div>

    <div class="row"> 
        <div class="col-sm-6">
            <div class="panel panel-custom">
                <div class="panel-heading">{% trans "Tagesordnung" %}</div>
                <div class="panel-body">
                    {% if meeting.imported %}
                        {% trans "siehe Protokoll" %}
                    {% else %}
                        <ul class="ul-noindent">
                            {% for top in tops %}
                                <li><strong>{% trans "TOP" %} {{ top.get_topid }}: {{ top.title }}</strong></li>
                            {% endfor %}
                        </ul>
                        {% if not meeting.topdeadline_over or meeting.meetingtype.admin_permission in perms or user == meeting.sitzungsleitung %}
                            <a href="{% url "addtop" meeting.meetingtype.id meeting.id %}" class="asbtn">{% bootstrap_icon "plus" %}&nbsp;{% trans "TOP hinzufügen" %}</a>
                        {% endif %}
                    {% endif %}
                </div>
            </div>

            {% if not meeting.imported %}
            <div class="panel panel-custom">
                <div class="panel-heading">{% trans "Tagesordnung" %} - {% trans "Details" %}</div>
                <div class="panel-body">
                    <ul class="ul-nobullet">
                        {% for top in tops %}
                            <li><div class="top-header"><strong>{% trans "TOP" %} {{ top.get_topid }}: {{ top.title }}</strong>{%if top.author and top.email %} ({{ top.author }}, {{ top.email|obfuscate }}){% endif %}{% if top.description %}:{% endif %}
                                {% if meeting.meetingtype.admin_permission in perms or user == meeting.sitzungsleitung %}
                                    <a href="{% url "edittop" meeting.meetingtype.id meeting.id top.id%}">{% bootstrap_icon "edit" %}</a>
                                    <a href="{% url "deltop" meeting.meetingtype.id meeting.id top.id%}">{% bootstrap_icon "trash" %}</a>
                                {% endif %}
                                </div>
                                <p>{{ top.description | safe }}</p>
                                {% if user.is_authenticated and meeting.meetingtype.attachment_tops and top.attachment %}
                                    <p><a href="{% url "showattachment" meeting.meetingtype.id meeting.id top.id %}">{% bootstrap_icon "paperclip" %}{% trans "Anhang" %}</a></p>
                                {% endif %}
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
            {% endif %}
        </div>
        <div class="col-sm-6">
            <div class="panel panel-custom">
                <div class="panel-heading">{% trans "Übersicht" %}</div>
                <div class="panel-body">
                    <table class="table table-panel">
                        <tr><th>{% trans "Zeit" %}:</th>
                            <td>{{ meeting.time | date:"D" }} {{ meeting.time | date:"SHORT_DATETIME_FORMAT" }}</td> </tr>
                        <tr><th>{% trans "Raum" %}:</th>
                            <td>{{ meeting.room }}</td> </tr>
                        <tr><th>{% trans "TOP-Deadline" %}:</th>
                            <td>{{ meeting.topdeadline | date:"D" }} {{ meeting.topdeadline | date:"SHORT_DATETIME_FORMAT" }}</td> </tr>
                        <tr><th>{% trans "Sitzungsleitung" %}:</th>
                            <td>{{ meeting.sl }}</td> </tr>
                        <tr><th>{% trans "Protokollant*in" %}:</th>
                            <td>{{ meeting.pl }}
                                {% if protokollant_form %}
                                    <form method="post" action="">
                                        {% csrf_token %}
                                        <button type="submit" class="btn btn-default btn-info">{% trans "Ich schreibe das Protokoll" %}</button>
                                    </form>
                                {% endif %}
                            </td> </tr>
                        <tr><th>{% trans "Protokoll" %}:</th>
                            <td>
                                {% if protokoll_exists %}
                                    {% if meeting.meetingtype.permission in perms or meeting.protokoll.approved %}
                                        <a class="asbtn-left" href="{% url "protokoll" meeting.meetingtype.id meeting.id "html" %}">{% bootstrap_icon "file" %} HTML</a>
                                        <a class="asbtn" href="{% url "protokoll" meeting.meetingtype.id meeting.id "pdf" %}">{% bootstrap_icon "file" %} PDF</a>
                                        <a class="asbtn-right" href="{% url "protokoll" meeting.meetingtype.id meeting.id "txt" %}">{% bootstrap_icon "file" %} TXT</a>
                                    {% else %}
                                        {% trans "noch nicht genehmigt" %}
                                    {% endif %}
                                {% else %}
                                    {% trans "noch nicht verfügbar" %}
                                {% endif %}
                            </td>
                        </tr>
                        {% if meeting.meetingtype.permission in perms and attachments %}
                            <tr><th>{% trans "Anhänge" %}:</th>
                                <td>
                                    <ul class="ul-noindent">
                                        {% for attachment in attachments %}
                                            <li>
                                                <strong>{% trans "Anhang" %} {{ attachment.get_attachmentid }}:</strong>
                                                <a href="{% url "showattachment_protokoll" meeting.meetingtype.id meeting.id attachment.id %}">{% bootstrap_icon "paperclip" %} {{ attachment.name }}</a>
                                            </li>
                                        {% endfor %}
                                    </ul>
                                </td>
                            </tr>
                        {% endif %}
                    </table>
                </div>
            </div>

            {% if meeting.meetingtype.admin_permission in perms or user == meeting.sitzungsleitung %}
                <div class="panel panel-custom">
                    <div class="panel-heading">{% trans "Sitzung bearbeiten" %}</div>
                    <div class="panel-body">
                        <p>
                            <strong>{% trans "Sitzung bearbeiten" %}:</strong>
                            <a href="{% url "editmeeting" meeting.meetingtype.id meeting.id %}" class="asbtn">{% bootstrap_icon "edit" %}&nbsp;{% trans "Sitzung bearbeiten" %}</a>
                            {% if meeting.meetingtype.admin_permission in perms %}
                            <a href="{% url "delmeeting" meeting.meetingtype.id meeting.id %}" class="asbtn">{% bootstrap_icon "trash" %}&nbsp;{% trans "Sitzung löschen" %}</a>
                            {% endif %}
                            {% if not meeting.imported %}
                                <a href="{% url "edittops" meeting.meetingtype.id meeting.id %}" class="asbtn-right">{% bootstrap_icon "sort" %}&nbsp;{% trans "Reihenfolge der TOPs bearbeiten" %}</a>
                            {% endif %}
                        </p>
                        {% if not meeting.imported %}
                            <p>
                                <strong>{% trans "E-Mails senden" %}:</strong>
                                <a href="{% url "sendinvitation" meeting.meetingtype.id meeting.id %}" class="asbtn">{% bootstrap_icon "send" %}&nbsp;{% trans "Einladung verschicken" %}</a>
                                <a href="{% url "sendtops" meeting.meetingtype.id meeting.id %}" class="asbtn">{% bootstrap_icon "send" %}&nbsp;{% trans "Tagesordnung verschicken" %}</a>
                                {% if protokoll_exists %}
                                    <a href="{% url "sendprotokoll" meeting.meetingtype.id meeting.id %}" class="asbtn-right">{% bootstrap_icon "send" %}&nbsp;{% trans "Protokoll verschicken" %}</a>
                                {% endif %}
                            </p>
                        {% endif %}
                    </div>
                </div>
            {% endif %}

            {% if not meeting.imported %} {# and #} {% if meeting.meetingtype.admin_permission in perms or user == meeting.sitzungsleitung or user == meeting.protokollant %}
                <div class="panel panel-custom">
                    <div class="panel-heading">{% trans "Protokoll bearbeiten" %}</div>
                    <div class="panel-body">
                        <p>
                            <strong>{% trans "Protokoll schreiben" %}:</strong>
                            <a href="{% url "templates" meeting.meetingtype.id meeting.id %}" class="asbtn">{% bootstrap_icon "save-file" %}&nbsp;{% trans "Vorlage herunterladen" %}</a>
                            {% if meeting.meetingtype.pad %}
                                <a href="{% url "pad" meeting.meetingtype.id meeting.id %}" class="asbtn-right">{% bootstrap_icon "cloud" %}&nbsp;{% trans "Vorlage online bearbeiten" %}</a>
                            {% endif %}
                        </p>
                        {% if meeting.meetingtype.attendance %}
                            {% if meeting.meetingtype.attachment_protokoll %}
                                <p>
                                    <strong>{% trans "Anwesenheitsliste" %}/{% trans "Anhänge" %}:</strong>
                                    <a href="{% url "addattendees" meeting.meetingtype.id meeting.id %}" class="asbtn">{% bootstrap_icon "user" %}&nbsp;{% trans "Anwesenheitsliste bearbeiten" %}</a>
                                    <a href="{% url "attachments" meeting.meetingtype.id meeting.id %}" class="asbtn-right">{% bootstrap_icon "paperclip" %}&nbsp;{% trans "Anhänge hinzufügen/bearbeiten" %}</a>
                                </p>
                            {% else %}
                                <p>
                                    <strong>{% trans "Anwesenheitsliste" %}:</strong>
                                    <a href="{% url "addattendees" meeting.meetingtype.id meeting.id %}" class="asbtn-right">{% bootstrap_icon "user" %}&nbsp;{% trans "Anwesenheitsliste bearbeiten" %}</a>
                                </p>
                            {% endif %}
                        {% else %}
                            <p>
                                <strong>{% trans "Anhänge" %}:</strong>
                                <a href="{% url "attachments" meeting.meetingtype.id meeting.id %}" class="asbtn-right">{% bootstrap_icon "paperclip" %}&nbsp;{% trans "Anhänge hinzufügen/bearbeiten" %}</a>
                            </p>
                        {% endif %}
                        <p>
                            <strong>{% trans "Protokoll bearbeiten" %}:</strong>
                            <a href="{% url "editprotokoll" meeting.meetingtype.id meeting.id %}" class="asbtn">{% bootstrap_icon "copy" %}&nbsp;{% trans "Protokoll erstellen" %}</a>
                            <a href="{% url "delprotokoll" meeting.meetingtype.id meeting.id %}" class="asbtn">{% bootstrap_icon "trash" %}&nbsp;{% trans "Protokoll löschen" %}</a>
                            {% if protokoll_exists %}
                                <a href="{% url "sendprotokoll" meeting.meetingtype.id meeting.id %}" class="asbtn-right">{% bootstrap_icon "send" %}&nbsp;{% trans "Protokoll verschicken" %}</a>
                            {% endif %}
                        </p>
                    </div>
                </div>
            {% endif %} {% endif %}
    
            {% if not meeting.imported and attendees != None %}
            <div class="panel panel-custom">
                <div class="panel-heading">{% trans "Anwesenheitsliste" %} ({{ attendees|length }} {% trans "Personen anwesend" %})</div>
                <div class="panel-body">
                    <ul class="ul-noindent">
                        {% for attendee in attendees %}
                        <li><strong>{{ attendee.name }}</strong>{% if meeting.meetingtype.attendance_with_func %} {{ attendee.get_functions }}{% endif %}</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
{% endblock %}

