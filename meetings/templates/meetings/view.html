{% extends "toptool_common/base.html" %}
{% load i18n %}
{% load email_obfuscator %}

{% block title %}{{ meeting.meetingtype }} - {% trans "Details zur Sitzung" %}{% endblock %}

{% block content %}
    <h1>
        {% blocktrans trimmed with title=meeting.get_title time=meeting.time|date:"SHORT_DATETIME_FORMAT" %}
            {{ title }} am {{ time }}
        {% endblocktrans %}
    </h1>

    <div class="panel panel-default">
        <div class="panel-body row">
            <div class="col-sm-1">
                {% if meeting.previous %}
                    <a href="{% url "viewmeeting" meeting.meetingtype.id meeting.previous.id %}" class="btn btn-default"><span class="glyphicon glyphicon-chevron-left"></span></a>
                {% endif %}
            </div>
            <div class="col-sm-2">
                <a href="{% url "viewmt" meeting.meetingtype.id %}" class="btn btn-default">{% trans "zurück zur Übersicht" %}</a>
            </div>
            {% if meeting.meetingtype.admin_permission in perms or user == meeting.sitzungsleitung %}
                <div class="col-sm-2">
                    <a href="{% url "editmeeting" meeting.meetingtype.id meeting.id %}" class="btn btn-default">{% trans "Sitzung bearbeiten" %}</a>
                </div>
                <div class="col-sm-2">
                    {% if meeting.meetingtype.admin_permission in perms %}
                        <a href="{% url "delmeeting" meeting.meetingtype.id meeting.id %}" class="btn btn-default">{% trans "Sitzung löschen" %}</a>
                    {% endif %}
                </div>
                <div class="col-sm-2">
                    {% if not meeting.imported %}
                        <a href="{% url "sendinvitation" meeting.meetingtype.id meeting.id %}" class="btn btn-default">{% trans "Einladung zur Sitzung per E-Mail versenden" %}</a>
                    {% endif %}
                </div>
            {% else %}
                <div class="col-sm-6">
                </div>
            {% endif %}
            <div class="col-sm-2">
            </div>
            <div class="col-sm-1">
                {% if meeting.next %}
                    <a href="{% url "viewmeeting" meeting.meetingtype.id meeting.next.id %}" class="btn btn-default"><span class="glyphicon glyphicon-chevron-right"></span></a>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="row"> 
        <div class="col-sm-6">
            <div class="panel panel-default">
                <div class="panel-heading">{% trans "Tagesordnung" %}</div>
                <div class="panel-body">
                    {% if meeting.imported %}
                        {% trans "siehe Protokoll" %}
                    {% else %}
                        <ul>
                            {% for top in tops %}
                                <li><strong>{% trans "TOP" %} {{ top.get_topid }}: {{ top.title }}</strong></li>
                            {% endfor %}
                        </ul>
                    {% endif %}
                </div>
            </div>

            {% if not meeting.imported %}
            <div class="panel panel-default">
                <div class="panel-heading">{% trans "Tagesordnung" %} - {% trans "Details" %}</div>
                <div class="panel-body">
                    <ul>
                        {% for top in tops %}
                            <li><strong>{% trans "TOP" %} {{ top.get_topid }}: {{ top.title }}</strong>{%if top.author and top.email %} ({{ top.author }}, {{ top.email|obfuscate }}){% endif %}{% if top.description %}:{% endif %}
                                {% if meeting.meetingtype.admin_permission in perms or user == meeting.sitzungsleitung %}
                                    <a href="{% url "edittop" meeting.meetingtype.id meeting.id top.id%}"><span class="glyphicon glyphicon-edit"></span></a>
                                    <a href="{% url "deltop" meeting.meetingtype.id meeting.id top.id%}"><span class="glyphicon glyphicon-trash"></span></a>
                                {% endif %}
                                <p>{{ top.description | safe }}</p>
                            </li>
                        {% endfor %}
                    </ul>
   
                    <div class="row">
                        <div class="col-sm-4">
                            {% if not meeting.topdeadline_over or meeting.meetingtype.admin_permission in perms or user == meeting.sitzungsleitung %}
                                <a href="{% url "addtop" meeting.meetingtype.id meeting.id %}" class="btn btn-default">{% trans "TOP hinzufügen" %}</a>
                            {% endif %}
                        </div>
                        <div class="col-sm-4"> 
                            {% if meeting.meetingtype.admin_permission in perms or user == meeting.sitzungsleitung %}
                                <a href="{% url "edittops" meeting.meetingtype.id meeting.id %}" class="btn btn-default">{% trans "Reihenfolge bearbeiten" %}</a>
                            {% endif %}
                        </div>
                    </div>
                    <p></p>
                    <div class="row">
                        <div class="col-sm-4">
                            {% if meeting.meetingtype.admin_permission in perms or user == meeting.sitzungsleitung %}
                                <a href="{% url "sendtops" meeting.meetingtype.id meeting.id %}" class="btn btn-default">{% trans "Tagesordnung per E-Mail versenden" %}</a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
        <div class="col-sm-1">
        </div>
        <div class="col-sm-5">
            <div class="panel panel-default">
                <div class="panel-heading">{% trans "Details" %}</div>
                <div class="panel-body">
                    <table class="table">
                        <tr><th>{% trans "Zeit" %}:</th>
                            <td>{{ meeting.time | date:"D" }} {{ meeting.time | date:"SHORT_DATETIME_FORMAT" }}</td> </tr>
                        <tr><th>{% trans "Raum" %}:</th>
                            <td>{{ meeting.room }}</td> </tr>
                        <tr><th>{% trans "TOP-Deadline" %}:</th>
                            <td>{{ meeting.topdeadline | date:"D" }} {{ meeting.topdeadline | date:"SHORT_DATETIME_FORMAT" }}</td> </tr>
                        <tr><th>{% trans "Sitzungsleitung" %}:</th>
                            <td>{{ meeting.sl }}</td> </tr>
                        <tr><th>{% trans "Protokollant*in" %}:</th>
                            <td>{{ meeting.pl }}</td> </tr>
                        <tr><th>{% trans "Protokoll" %}:</th>
                            <td>
                                {% if protokoll_exists %}
                                    {% if meeting.meetingtype.permission in perms or meeting.protokoll.approved %}
                                        <p><a href="{% url "protokoll" meeting.meetingtype.id meeting.id "html" %}" class="btn btn-default">HTML</a>
                                        <a href="{% url "protokoll" meeting.meetingtype.id meeting.id "pdf" %}" class="btn btn-default">PDF</a>
                                        <a href="{% url "protokoll" meeting.meetingtype.id meeting.id "txt" %}" class="btn btn-default">TXT</a></p>
                                    {% endif %}
                                {% endif %}
                                {% if not protokoll_exists and not meeting.imported %}
                                    {% if not meeting.protokollant and meeting.meetingtype.permission in perms %}
                                        <p><a href="{% url "editprotokoll" meeting.meetingtype.id meeting.id %}" class="btn btn-default">{% trans "hinzufügen" %}</a></p>
                                    {% elif meeting.meetingtype.admin_permission in perms or user == meeting.sitzungsleitung or user == meeting.protokollant %}
                                        <p><a href="{% url "editprotokoll" meeting.meetingtype.id meeting.id %}" class="btn btn-default">{% trans "hinzufügen" %}</a></p>
                                    {% endif %}
                                {% elif meeting.meetingtype.admin_permission in perms or user == meeting.sitzungsleitung or user == meeting.protokollant %}
                                    {% if not meeting.imported %}
                                        <a href="{% url "editprotokoll" meeting.meetingtype.id meeting.id %}" class="btn btn-default">{% trans "bearbeiten" %}</a>
                                        <a href="{% url "sendprotokoll" meeting.meetingtype.id meeting.id %}" class="btn btn-default">{% trans "per E-Mail versenden" %}</a>
                                    {% endif %}
                                {% endif %}
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
    
            {% if not meeting.imported and attendees != None %}
            <div class="panel panel-default">
                <div class="panel-heading">{% trans "Anwesenheitsliste" %} ({{ attendees|length }} {% trans "Personen anwesend" %})</div>
                <div class="panel-body">
                    <ul>
                        {% for attendee in attendees %}
                        <li><strong>{{ attendee.name }}</strong>{% if meeting.meetingtype.attendance_with_func %} {{ attendee.get_functions }}{% endif %}</li>
                        {% endfor %}
                    </ul>
                    {% if meeting.meetingtype.admin_permission in perms or user == meeting.sitzungsleitung or user == meeting.protokollant %}
                        <a href="{% url "addattendees" meeting.meetingtype.id meeting.id %}" class="btn btn-default">{% trans "Anwesenheitsliste bearbeiten" %}</a>
                    {% endif %}
                </div>
            </div>
            {% endif %}
        </div>
    </div>
{% endblock %}

