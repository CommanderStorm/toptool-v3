{% extends "base.html" %}
{% load i18n %}
{% load email_obfuscator %}
{% load django_bootstrap5 %}

{% block title %}{{ meeting.meetingtype }} - {% trans "Details zur Sitzung" %}{% endblock %}

{% block content %}
<h1>
    {% blocktrans trimmed with title=meeting.get_title time=meeting.time|date:"SHORT_DATETIME_FORMAT" %}
    {{ title }} am {{ time }}
    {% endblocktrans %}
</h1>

<div class="row toprow">
    <h4>
        <div class="col-sm-3">
            {% if meeting.previous %}
            <a
                href="{% url "viewmeeting" meeting.meetingtype.id meeting.previous.id %}"
                class="asbtn-left"
            ><span class="bi bi-chevron-left"></span><noscript>{% trans "vorherige Sitzung" %}</noscript></a>
            {% endif %}
        </div>
        <div
            class="col-sm-6"
            style="text-align: center;"
        >
            <a
                href="{% url "viewmt" meeting.meetingtype.id %}"
                class="asbtn"
            ><span class="bi bi-list"></span>&nbsp;{% trans "zurück zur Übersicht" %}</a>
        </div>
        <div class="col-sm-3">
            {% if meeting.next %}
            <a
                href="{% url "viewmeeting" meeting.meetingtype.id meeting.next.id %}"
                class="asbtn-right"
                style="float: right;"
            ><span class="bi bi-chevron-right"></span><noscript>{% trans "nächste Sitzung" %}</noscript></a>
            {% endif %}
        </div>
    </h4>
</div>

<div class="row">
    {% if meeting.meetingtype.tops %}
    <div class="col-sm-6">
        <div class="panel panel-custom">
            <div
                class="panel-heading collapse-toggle"
                data-toggle="collapse"
                data-target="#top-body"
            >{% trans "Tagesordnung" %}</div>
            <div
                class="collapse in"
                id="top-body"
            >
                {% if meeting.imported %}
                <div class="panel-body">
                    {% trans "siehe Protokoll" %}
                </div>
                {% else %}
                <div class="list-group panel-table">
                    {% for top in tops %}
                    <a
                        href="#top{{ top.get_topid }}"
                        class="list-group-item"
                    ><strong>{% trans "TOP" %} {{ top.get_topid }}: {{ top.title }}</strong></a>
                    {% endfor %}
                </div>
                {% if meeting.meetingtype.top_perms == "public" %}
                {% if not meeting.topdeadline_over or meeting.meetingtype.admin_permission in perms or user == meeting.sitzungsleitung %}
                <div class="panel-body">
                    <a
                        href="{% url "addtop" meeting.meetingtype.id meeting.id %}"
                        class="asbtn"
                    ><span class="bi bi-plus"></span>&nbsp;{% trans "TOP hinzufügen" %}</a>
                </div>
                {% endif %}
                {% elif meeting.meetingtype.top_perms == "perm" and meeting.meetingtype.permission in perms %}
                {% if not meeting.topdeadline_over or meeting.meetingtype.admin_permission in perms or user == meeting.sitzungsleitung %}
                <div class="panel-body">
                    <a
                        href="{% url "addtop" meeting.meetingtype.id meeting.id %}"
                        class="asbtn"
                    ><span class="bi bi-plus"></span>&nbsp;{% trans "TOP hinzufügen" %}</a>
                </div>
                {% endif %}
                {% elif meeting.meetingtype.top_perms == "admin" %}
                {% if meeting.meetingtype.admin_permission in perms or user == meeting.sitzungsleitung %}
                <div class="panel-body">
                    <a
                        href="{% url "addtop" meeting.meetingtype.id meeting.id %}"
                        class="asbtn"
                    ><span class="bi bi-plus"></span>&nbsp;{% trans "TOP hinzufügen" %}</a>
                </div>
                {% endif %}
                {% endif %}
                {% endif %}
            </div>
        </div>

        {% if not meeting.imported %}
        <div class="panel panel-custom">
            <div
                class="panel-heading collapse-toggle"
                data-toggle="collapse"
                data-target="#top-details-body"
            >{% trans "Tagesordnung" %} - {% trans "Details" %}</div>
            <ul
                class="list-group collapse in"
                id="top-details-body"
            >
                {% for top in tops %}
                <li
                    id="top{{ top.get_topid }}"
                    class="list-group-item"
                >
                    <div class="list-group-item-heading">
                        <strong>{% trans "TOP" %} {{ top.get_topid }}: {{ top.title }}</strong>{%if top.author and top.email %} ({{ top.author }}, {{ top.email|obfuscate }}){% endif %}{% if top.description %}:{% endif %}
                        {% if meeting.meetingtype.admin_permission in perms or user == meeting.sitzungsleitung or meeting.meetingtype.top_user_edit and not meeting.topdeadline_over and meeting.meetingtype.permission in perms and user == top.user %}
                        <a href="{% url "edittop" meeting.meetingtype.id meeting.id top.id%}"><span class="bi bi-pencil-square"></span><noscript>{% trans "bearbeiten" %}</noscript></a>
                        <a href="{% url "deltop" meeting.meetingtype.id meeting.id top.id%}"><span class="bi bi-trash"></span><noscript>{% trans "löschen" %}</noscript></a>
                        {% endif %}
                    </div>
                    <p class="list-group-item-text">{{ top.description | safe }}</p>
                    {% if meeting.meetingtype.attachment_tops and top.attachment %}
                    <p><a href="{% url "showattachment" meeting.meetingtype.id meeting.id top.id %}"><span class="bi bi-paperclip"></span>{% trans "Anhang" %}</a></p>
                    {% endif %}
                </li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}
    </div>
    {% endif %}
    <div class="col-sm-6">
        <div class="panel panel-custom">
            <div
                class="panel-heading collapse-toggle"
                data-toggle="collapse"
                data-target="#overview-body"
            >{% trans "Übersicht" %}</div>
            <div
                class="collapse in"
                id="overview-body"
            >
                <table class="table table-hover panel-table">
                    <tr>
                        <th>{% trans "Zeit" %}:</th>
                        <td>{{ meeting.time | date:"D" }} {{ meeting.time | date:"SHORT_DATETIME_FORMAT" }}</td>
                    </tr>
                    <tr>
                        <th>{% trans "Raum" %}:</th>
                        <td>{{ meeting.room | urlize }}</td>
                    </tr>
                    {% if meeting.meetingtype.tops and meeting.meetingtype.top_deadline %}
                    <tr>
                        <th>{% trans "TOP-Deadline" %}:</th>
                        <td>{{ meeting.topdeadline | date:"D" }} {{ meeting.topdeadline | date:"SHORT_DATETIME_FORMAT" }}</td>
                    </tr>
                    {% endif %}
                    <tr>
                        <th>{% trans "Sitzungsleitung" %}:</th>
                        <td>{{ meeting.sitzungsleitung_string }}</td>
                    </tr>
                    {% if meeting.meetingtype.protokoll %}
                    <tr>
                        <th>{% trans "Protokollant*innen" %}:</th>
                        <td>{{ meeting.min_takers_string }}
                            {% if protokollant_form %}
                            <form
                                method="post"
                                action=""
                            >
                                {% csrf_token %}
                                <button
                                    type="submit"
                                    class="btn btn-default"
                                    style="margin-top:5px;"
                                >{% trans "Ich schreibe das Protokoll" %}</button>
                            </form>
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <th>{% if protokoll_published and not meeting.protokoll.approved %}{% trans "Vorläufiges Protokoll" %}{% else %}{% trans "Protokoll" %}{% endif %}:</th>
                        <td>
                            {% if protokoll_published %}
                            {% if meeting.meetingtype.permission in perms or meeting.protokoll.approved %}
                            <a
                                class="asbtn-left"
                                href="{% url "protokoll" meeting.meetingtype.id meeting.id "html" %}"
                            >{% if meeting.protokoll.approved %}<span class="bi bi-file-arrow-down"></span>{% else %}<span class="bi bi-cloud-check"></span>{% endif %} HTML</a>
                            <a
                                class="asbtn"
                                href="{% url "protokoll" meeting.meetingtype.id meeting.id "pdf" %}"
                            >{% if meeting.protokoll.approved %}<span class="bi bi-file-arrow-down"></span>{% else %}<span class="bi bi-cloud-check"></span>{% endif %} PDF</a>
                            <a
                                class="asbtn-right"
                                href="{% url "protokoll" meeting.meetingtype.id meeting.id "txt" %}"
                            >{% if meeting.protokoll.approved %}<span class="bi bi-file-arrow-down"></span>{% else %}<span class="bi bi-cloud-check"></span>{% endif %} TXT</a>
                            {% else %}
                            {% trans "noch nicht genehmigt" %}
                            {% endif %}
                            {% else %}
                            {% trans "noch nicht verfügbar" %}
                            {% endif %}
                        </td>
                    </tr>
                    {% if meeting.meetingtype.permission in perms and attachments %}
                    <tr>
                        <th>{% trans "Anhänge" %}:</th>
                        <td>
                            <ul class="ul-noindent">
                                {% for attachment in attachments %}
                                <li>
                                    <strong>{% trans "Anhang" %} {{ attachment.get_attachmentid }}:</strong>
                                    <a href="{% url "showattachment_protokoll" meeting.meetingtype.id meeting.id attachment.id %}"><span class="bi bi-paperclip"></span> {{ attachment.name }}</a>
                                </li>
                                {% endfor %}
                            </ul>
                        </td>
                    </tr>
                    {% endif %}
                    {% endif %}
                </table>
            </div>
        </div>

        {% if not meeting.meetingtype.tops and not meeting.meetingtype.attendance %}
    </div>
    <div class="col-sm-6">
        {% endif %}

        {% if meeting.meetingtype.admin_permission in perms or user == meeting.sitzungsleitung %}
        <div class="panel panel-custom">
            <div
                class="panel-heading collapse-toggle"
                data-toggle="collapse"
                data-target="#meeting-edit-body"
            >{% trans "Sitzung bearbeiten" %}</div>
            <div
                class="panel-body collapse in"
                id="meeting-edit-body"
            >
                <p>
                    <strong>{% trans "Sitzung bearbeiten" %}:</strong>
                    <a
                        href="{% url "editmeeting" meeting.meetingtype.id meeting.id %}"
                        class="asbtn"
                    ><span class="bi bi-pencil-square"></span>&nbsp;{% trans "Sitzung bearbeiten" %}</a>
                    {% if meeting.meetingtype.admin_permission in perms %}
                    <a
                        href="{% url "delmeeting" meeting.meetingtype.id meeting.id %}"
                        class="asbtn"
                    ><span class="bi bi-trash"></span>&nbsp;{% trans "Sitzung löschen" %}</a>
                    {% endif %}
                </p>
                {% if not meeting.imported and meeting.meetingtype.tops %}
                <p>
                    <strong>{% trans "TOPs" %}:</strong>
                    <a
                        href="{% url "interactivetops" meeting.meetingtype.id meeting.id %}"
                        class="asbtn"
                    ><span class="bi bi-view-list"></span>&nbsp;{% trans "Interaktive Tagesordnung" %}</a>
                    <a
                        href="{% url "edittops" meeting.meetingtype.id meeting.id %}"
                        class="asbtn-right"
                    ><span class="bi bi-arrow-down-up"></span>&nbsp;{% trans "Reihenfolge der TOPs bearbeiten" %}</a>
                </p>
                {% endif %}
                {% if not meeting.imported and meeting.meetingtype.attendance %}
                <p>
                    <strong>{% trans "Anwesenheitsliste" %}:</strong>
                    <a
                        href="{% url "addattendees" meeting.meetingtype.id meeting.id %}"
                        class="asbtn-right"
                    ><span class="bi bi-person-fill"></span>&nbsp;{% trans "Anwesenheitsliste bearbeiten" %}</a>
                </p>
                {% endif %}
                {% if not meeting.imported and meeting.meetingtype.protokoll %}
                {% if protokoll_exists or meeting.meetingtype.pad %}
                {% if protokoll_exists or meeting.pad %}
                <p>
                    <strong>{% trans "Protokoll löschen" %}:</strong>
                    {% if meeting.meetingtype.pad and meeting.pad %}
                    <a
                        href="{% url "delpad" meeting.meetingtype.id meeting.id %}"
                        class="asbtn"
                    ><span class="bi bi-trash"></span>&nbsp;{% trans "Pad löschen" %}</a>
                    {% endif %}
                    {% if protokoll_exists %}
                    <a
                        href="{% url "delprotokoll" meeting.meetingtype.id meeting.id %}"
                        class="asbtn"
                    ><span class="bi bi-trash"></span>&nbsp;{% trans "Protokoll löschen" %}</a>
                    {% endif %}
                </p>
                {% endif %}
                {% endif %}
                {% endif %}
                {% if not meeting.imported and meeting.meetingtype.email_sending_enabled %}
                <p>
                    <strong>{% trans "E-Mails senden" %}:</strong>
                    {% if meeting.meetingtype.send_invitation_enabled %}
                    <a
                        href="{% url "sendinvitation" meeting.meetingtype.id meeting.id %}"
                        class="asbtn"
                    ><span class="bi bi-send"></span>&nbsp;{% trans "Einladung verschicken" %}</a>
                    {% endif %}
                    {% if meeting.meetingtype.send_tops_enabled %}
                    <a
                        href="{% url "sendtops" meeting.meetingtype.id meeting.id %}"
                        class="asbtn"
                    ><span class="bi bi-send"></span>&nbsp;{% trans "Tagesordnung verschicken" %}</a>
                    {% endif %}
                    {% if meeting.meetingtype.send_minutes_enabled and protokoll_published %}
                    <a
                        href="{% url "sendprotokoll" meeting.meetingtype.id meeting.id %}"
                        class="asbtn-right"
                    ><span class="bi bi-send"></span>&nbsp;{% trans "Protokoll verschicken" %}</a>
                    {% endif %}
                </p>
                {% endif %}
            </div>
        </div>
        {% endif %}

        {% if meeting.meetingtype.protokoll and not meeting.imported %} {# and #} {% if meeting.meetingtype.admin_permission in perms or user == meeting.sitzungsleitung or user in meeting.minute_takers.all %}
        <div class="panel panel-custom">
            <div
                class="panel-heading collapse-toggle"
                data-toggle="collapse"
                data-target="#minutes-edit-body"
            >{% trans "HowTo Protokoll" %}</div>
            <div
                class="panel-body collapse in"
                id="minutes-edit-body"
            >
                <ol start=0>
                    <li>
                        <strong>{% trans "Weitere Protokollant*innen hinzufügen" %}:</strong>
                        <a
                            href="{% url "addminutetakers" meeting.meetingtype.id meeting.id %}"
                            class="asbtn-right"
                        ><span class="bi bi-person-plus-fill"></span>&nbsp;{% trans "Weitere Protokollant*innen hinzufügen" %}</a>
                    </li>
                    <li>
                        <strong>{% trans "Protokoll schreiben" %}:</strong>
                        {% if meeting.meetingtype.pad %}
                        <ol type="a">
                            <li>
                                {% endif %}
                                <a
                                    href="{% url "templates" meeting.meetingtype.id meeting.id %}"
                                    class="asbtn-right asbtn-wrap"
                                ><span class="bi bi-save"></span>&nbsp;{% trans "Vorlage herunterladen und offline bearbeiten" %}</a>
                                {% if meeting.meetingtype.pad %}
                                {% trans "oder" %}
                            </li>
                            <li>
                                <a
                                    href="{% url "pad" meeting.meetingtype.id meeting.id %}"
                                    class="asbtn-right"
                                ><span class="bi bi-cloud"></span>&nbsp;{% trans "Protokoll online schreiben" %}</a>
                            </li>
                        </ol>
                        {% endif %}
                    </li>
                    {% if meeting.meetingtype.attachment_protokoll %}
                    <li>
                        <strong>{% trans "Ggf. Anhänge hinzufügen" %}:</strong>
                        <a
                            href="{% url "attachments" meeting.meetingtype.id meeting.id %}"
                            class="asbtn-right"
                        ><span class="bi bi-paperclip"></span>&nbsp;{% trans "Anhänge hinzufügen/bearbeiten" %}</a>
                    </li>
                    {% endif %}
                    {% if meeting.meetingtype.attendance %}
                    <li>
                        <strong>{% trans "Anwesenheitsliste bearbeiten" %}:</strong>
                        <a
                            href="{% url "addattendees" meeting.meetingtype.id meeting.id %}"
                            class="asbtn-right"
                        ><span class="bi bi-person-fill"></span>&nbsp;{% trans "Anwesenheitsliste bearbeiten" %}</a>
                    </li>
                    {% endif %}
                    <li>
                        <strong>{% trans "Protokoll erstellen" %}:</strong>
                        <a
                            href="{% url "editprotokoll" meeting.meetingtype.id meeting.id %}"
                            class="asbtn-right"
                        ><span class="bi bi-file-pdf"></span>&nbsp;{% trans "Protokoll erstellen" %}</a>
                    </li>
                    <li{% if not protokoll_exists or protokoll_published %}
                        class="disabled"
                        {% endif %}
                    >
                        <strong>{% trans "Erstelltes Protokoll überprüfen" %}:</strong>
                        <a
                            class="asbtn"
                            href="{% url "protokoll" meeting.meetingtype.id meeting.id "html" %}"
                        >{% if meeting.protokoll.approved %}<span class="bi bi-file-arrow-down"></span>{% else %}<span class="bi bi-cloud-check"></span>{% endif %} HTML</a>
                        <a
                            class="asbtn"
                            href="{% url "protokoll" meeting.meetingtype.id meeting.id "pdf" %}"
                        >{% if meeting.protokoll.approved %}<span class="bi bi-file-arrow-down"></span>{% else %}<span class="bi bi-cloud-check"></span>{% endif %} PDF</a>
                        <a
                            class="asbtn-right"
                            href="{% url "protokoll" meeting.meetingtype.id meeting.id "txt" %}"
                        >{% if meeting.protokoll.approved %}<span class="bi bi-file-arrow-down"></span>{% else %}<span class="bi bi-cloud-check"></span>{% endif %} TXT</a>
                        </li>
                        <li{% if not protokoll_exists or protokoll_published %}
                            class="disabled"
                            {% endif %}
                        >
                            <strong>{% trans "Protokoll veröffentlichen" %}:</strong>
                            <a
                                href="{% url "publishprotokoll" meeting.meetingtype.id meeting.id %}"
                                class="asbtn-right"
                            ><span class="bi bi-people"></span>&nbsp;{% trans "Protokoll veröffentlichen" %}</a>
                            </li>
                            {% if meeting.meetingtype.send_minutes_enabled %}
                            <li{% if not protokoll_published %}
                                class="disabled"
                                {% endif %}
                            >
                                <strong>{% trans "Protokoll verschicken" %}:</strong>
                                <a
                                    href="{% url "sendprotokoll" meeting.meetingtype.id meeting.id %}"
                                    class="asbtn-right"
                                ><span class="bi bi-send"></span>&nbsp;{% trans "Protokoll verschicken" %}</a>
                                </li>
                                {% endif %}
                </ol>
            </div>
        </div>
        {% endif %} {% endif %}

        {% if not meeting.meetingtype.tops %}
    </div>
    <div class="col-sm-6">
        {% endif %}

        {% if not meeting.imported and attendees != None %}
        <div class="panel panel-custom">
            <div
                class="panel-heading collapse-toggle"
                data-toggle="collapse"
                data-target="#attendees-body"
            >{% trans "Anwesenheitsliste" %} ({{ attendees|length }} {% trans "Personen anwesend" %})</div>
            <ul
                class="list-group collapse in"
                id="attendees-body"
            >
                {% for attendee in attendees %}
                <li class="list-group-item"><strong>{{ attendee.name }}</strong>{% if meeting.meetingtype.attendance_with_func %} {{ attendee.get_functions }}{% endif %}</li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
